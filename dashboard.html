<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | Courage Library</title>

<link rel="icon" type="image/png" href="/images/logo.png" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- ================= HEADER (Same as index) ================= -->
<nav class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <a href="index.html" class="flex items-center space-x-2">
      <img src="/images/logo.png" class="w-8 h-8">
      <span class="text-2xl font-bold text-blue-700">Courage Library</span>
    </a>
    <button onclick="logout()" 
      class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-5 py-2 rounded-full shadow">
      Logout
    </button>
  </div>
</nav>

<!-- ================= MAIN ================= -->
<main class="flex-grow max-w-6xl mx-auto px-4 py-10">

  <!-- Welcome -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-blue-700">
      Welcome, <span id="userName">Student</span> üëã
    </h1>
    <p class="text-gray-600 mt-2">
      Continue your preparation journey.
    </p>
  </div>

  <!-- Enrollment Card -->
  <div id="enrollmentCard"
       class="bg-white shadow-xl rounded-2xl p-8 border border-gray-200 hidden">

      <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-6">

          <div>
              <h2 class="text-2xl font-semibold text-gray-800" id="courseName">
                  Course Name
              </h2>

              <p class="text-gray-500 mt-1" id="planName">
                  Plan Name
              </p>

              <p class="text-sm text-gray-600 mt-3">
                  Valid Till:
                  <span class="font-semibold text-blue-700" id="validTill">
                      00-00-0000
                  </span>
              </p>
          </div>

          <a id="continueBtn"
             class="bg-gradient-to-r from-blue-600 to-indigo-600
                    text-white px-6 py-3 rounded-xl font-semibold shadow
                    hover:scale-105 transition">
              Continue Learning
          </a>

      </div>

  </div>

  <!-- No Enrollment -->
  <div id="noEnrollment"
       class="bg-white shadow-lg rounded-xl p-8 text-center hidden">

      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        You are not enrolled in any course yet.
      </h2>

      <a href="enroll.html"
         class="bg-gradient-to-r from-blue-500 to-indigo-500
                text-white px-6 py-3 rounded-full font-semibold">
         Enroll Now
      </a>

  </div>

</main>

<!-- ================= FOOTER (Same as index) ================= -->
<footer class="bg-gradient-to-r from-blue-700 to-indigo-700 text-white py-5">
  <div class="max-w-6xl mx-auto px-4 text-center">
    ¬© 2025 Courage Library. All rights reserved.
  </div>
</footer>

<script>
/* ================= SUPABASE ================= */

const supaClient = window.supabase.createClient(
  'https://sgagswxzsxlgcspwiuoh.supabase.co',
  'YOUR_PUBLIC_ANON_KEY'
);

async function loadDashboard() {

    const { data: { session } } = await supaClient.auth.getSession();

    // üîê Not logged in
    if (!session) {
        window.location.href = "index.html?checkAuth=1";
        return;
    }

    const user = session.user;
    document.getElementById("userName").textContent =
        user.email.split("@")[0];

    // üîé Fetch enrollment
    const { data, error } = await supaClient
        .from("student_enrollments")
        .select("*")
        .eq("user_email", user.email)
        .order("created_at", { ascending: false })
        .limit(1)
        .single();

    if (data) {

        document.getElementById("courseName").textContent =
            data.course_name;

        document.getElementById("planName").textContent =
            data.plan_name;

        document.getElementById("validTill").textContent =
            data.valid_till;

        document.getElementById("continueBtn").href =
            data.course_name.replace(/\s+/g, "-") + ".html";

        document.getElementById("enrollmentCard").classList.remove("hidden");

    } else {
        document.getElementById("noEnrollment").classList.remove("hidden");
    }
}

async function logout() {
    await supaClient.auth.signOut();
    window.location.href = "index.html";
}

loadDashboard();
</script>

</body>
</html>
