<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Courage Library</title>

    <link rel="icon" type="image/png" href="/images/logo.png" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- ================= HEADER (Same as index) ================= -->
    <nav class="bg-white/90 backdrop-blur-lg shadow-md sticky top-0 z-50">
        <div class="w-full max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">

            <!-- Logo -->
            <a class="flex items-center space-x-2" href="index.html">
                <img src="/images/logo.png" alt="Logo" class="w-8 h-8">
                <span class="text-3xl font-bold text-blue-700 cursor-pointer">
                    Courage Library
                </span>
            </a>

            <!-- Desktop Navigation -->
            <div class="space-x-6 hidden md:flex items-center">

                <a href="index.html#features" class="hover:text-blue-600">Features</a>
                <a href="index.html#courses" class="hover:text-blue-600">Courses</a>
                <a href="index.html#testimonials" class="hover:text-blue-600">Testimonials</a>
                <a href="Blog/Blog.html" class="hover:text-blue-600">Blog</a>
                <a href="index.html#contact" class="hover:text-blue-600">Contact</a>

                <!-- Notification Bell -->
                <div class="relative">

                    <button id="notificationBell" class="relative text-gray-600 hover:text-blue-600 transition">

                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                        </svg>

                        <!-- Badge -->
                        <span id="notificationCount" class="hidden absolute -top-1 -right-1
            bg-red-500 text-white text-[10px]
            px-1.5 py-0.5 rounded-full">
                        </span>

                    </button>
                    <!-- Notification Dropdown -->
                    <div id="notificationDropdown" class="hidden absolute right-0 mt-3 w-80 bg-white
    rounded-xl shadow-2xl border border-gray-100
    z-50 overflow-hidden">

                        <!-- Header -->
                        <div class="flex items-center justify-between px-4 py-3 border-b">
                            <h4 class="text-sm font-semibold text-gray-900">
                                Notifications
                            </h4>

                            <button id="markAllReadBtn" class="text-xs text-blue-600 hover:underline">
                                Mark all as read
                            </button>
                        </div>

                        <!-- Notification List -->
                        <div id="notificationList" class="max-h-80 overflow-y-auto divide-y divide-gray-100">
                        </div>

                        <!-- Footer -->
                        <div class="px-4 py-3 border-t text-center">
                            <a href="notifications.html" class="text-sm text-blue-600 hover:underline">
                                View all notifications
                            </a>
                        </div>

                    </div>

                </div>

                <!-- Profile Wrapper -->
                <div class="relative flex items-center">

                    <!-- Profile Button -->
                    <button id="profileBtn" class="w-10 h-10 rounded-full
                 bg-gradient-to-r from-blue-500 to-indigo-600
                 text-white flex items-center justify-center
                 font-semibold text-sm shadow
                 hover:scale-110 transition">

                        <span id="userInitials">JD</span>
                    </button>

                    <!-- Dropdown -->
                    <div id="profileMenu" class="absolute right-0 top-full mt-3 w-72 bg-white
                 rounded-xl shadow-2xl border border-gray-100
                 opacity-0 scale-95 pointer-events-none
                 transition-all duration-200 ease-out z-50">

                        <!-- User Section -->
                        <div class="p-5 border-b border-gray-100 flex items-center gap-4">

                            <div class="w-12 h-12 aspect-square rounded-full
                        bg-gradient-to-r from-blue-600 to-indigo-600
                        flex items-center justify-center
                        text-white font-semibold text-sm">
                                <span id="menuInitials">JD</span>
                            </div>

                            <div class="leading-tight">
                                <p id="menuUserName" class="font-semibold text-gray-900 text-sm">
                                    John
                                </p>

                                <a href="enroll.html" class="block text-xs text-gray-500 mt-0.5
                        hover:text-indigo-600 transition font-medium">
                                    Access all features with our Premium subscription!
                                </a>
                            </div>

                        </div>

                        <!-- Menu Items -->
                        <div class="py-2">

                            <a href="dashboard.html" class="flex items-center gap-3 px-5 py-2.5 text-sm
                      text-gray-700 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                                </svg>
                                Dashboard
                            </a>
                            <!-- Notifications -->
                            <a href="notifications.html" onclick="openNotifications()"
                                class="w-full flex items-center justify-between px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition text-left">

                                <div class="flex items-center gap-3">
                                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                                    </svg>

                                    Notifications
                                </div>

                                <!-- Number Badge -->
                                <span id="mobileDropdownCount" class="hidden bg-indigo-100 text-indigo-700
    text-[11px] px-2 py-0.5
    rounded-full font-semibold">
                                </span>

                            </a>
                            <a href="my-plan.html" class="flex items-center gap-3 px-5 py-2.5 text-sm
          text-gray-700 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75" />
                                </svg>

                                My Plan
                            </a>
                            <!-- Support -->
                            <a href="contact.html"
                                class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" />
                                </svg>
                                Support
                            </a>
                            <a href="payment-history.html" class="flex items-center gap-3 px-5 py-2.5 text-sm
          text-gray-700 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="m9 14.25 6-6m4.5-3.493V21.75l-3.75-1.5-3.75 1.5-3.75-1.5-3.75 1.5V4.757c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0c1.1.128 1.907 1.077 1.907 2.185ZM9.75 9h.008v.008H9.75V9Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008V13.5Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                                </svg>
                                Payment History
                            </a>

                            <a href="settings.html" class="flex items-center gap-3 px-5 py-2.5 text-sm
          text-gray-700 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                                Settings
                            </a>

                            <!-- Divider -->
                            <div class="border-t border-gray-100 my-2"></div>

                            <button onclick="logout()" class="w-full flex items-center gap-3 px-5 py-2.5 text-sm
                      text-gray-600 hover:bg-gray-50 transition">
                                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                                </svg>

                                Logout
                            </button>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div class="md:hidden relative" x-data="{ open: false }">
                <!-- Hamburger -->
                <div class="relative">
                    <button @click="open = !open" class="focus:outline-none relative">
                        <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>

                        <!-- Dot Badge -->
                        <span id="mobileHamburgerDot" class="hidden absolute -top-1 -right-1
    w-2.5 h-2.5 rounded-full
    bg-indigo-600
    ring-2 ring-white">
                        </span>
                    </button>
                </div>
                <!-- Dropdown -->
                <div x-show="open" @click.away="open = false" x-transition
                    class="absolute right-0 mt-4 w-64 bg-white rounded-xl shadow-2xl border border-gray-100 z-50">
                    <!-- User Section -->
                    <div class="p-5 border-b border-gray-100 flex items-center gap-4">
                        <div
                            class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold text-sm">
                            <span id="mobileInitials">JD</span>
                        </div>
                        <div class="leading-tight">
                            <p id="mobileUserName" class="font-semibold text-gray-900 text-sm">
                                John
                            </p>
                            <p class="text-xs text-gray-500 mt-0.5">
                                Courage Library Member
                            </p>
                        </div>
                    </div>
                    <!-- Menu Items -->
                    <div class="py-2">
                        <!-- Dashboard -->
                        <a href="dashboard.html"
                            class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                            </svg>
                            Dashboard
                        </a>
                        <!-- Notifications -->
                        <button @click="open = false; openMobileNotifications()"
                            class="w-full flex items-center justify-between px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition text-left">

                            <div class="flex items-center gap-3">
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                                </svg>

                                Notifications
                            </div>

                            <!-- Number Badge -->
                            <span id="mobileMenuNotificationCount" class="hidden bg-indigo-100 text-indigo-700
    text-[11px] px-2 py-0.5
    rounded-full font-semibold">
                            </span>

                        </button>
                        <!-- My Plan -->
                        <a href="my-plan.html"
                            class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75" />
                            </svg>
                            My Plan
                        </a>
                        <!-- Support -->
                        <a href="contact.html"
                            class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" />
                            </svg>
                            Support
                        </a>
                        <!-- Payment History -->
                        <a href="payment-history.html"
                            class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="m9 14.25 6-6m4.5-3.493V21.75l-3.75-1.5-3.75 1.5-3.75-1.5-3.75 1.5V4.757c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0c1.1.128 1.907 1.077 1.907 2.185ZM9.75 9h.008v.008H9.75V9Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008V13.5Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                            </svg>
                            Payment History
                        </a>
                        <!-- Settings -->
                        <a href="settings.html"
                            class="flex items-center gap-3 px-5 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>
                            Settings
                        </a>
                        <div class="border-t border-gray-100 my-2"></div>
                        <!-- Logout -->
                        <button onclick="logout()"
                            class="w-full flex items-center gap-3 px-5 py-2.5 text-sm text-gray-600 hover:bg-gray-50 transition">
                            <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                            </svg>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ================= MAIN ================= -->
    <main class="relative flex-grow max-w-7xl mx-auto px-4 py-12 overflow-hidden">
        <div class="absolute inset-0 -z-10 bg-gradient-to-br from-blue-50 via-white to-indigo-50"></div>

        <!-- Welcome -->
        <div class="mb-8">
            <h1 id="welcomeHeading"
                class="text-3xl font-bold text-gray-900 tracking-tight opacity-0 transition-opacity duration-700">
            </h1>

            <p class="text-gray-600 mt-2">
                Continue your preparation journey.
            </p>
        </div>

        <div class="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-8"></div>


        <!-- ================= EXAM TARGET SECTION ================= -->
        <div id="examTargetCard" class="mb-12 hidden">

            <div class="relative bg-white border border-gray-200
                rounded-2xl p-8 shadow-sm
                transition-all duration-300 hover:shadow-md">

                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5 lg:gap-8">

                    <!-- LEFT SIDE -->
                    <div class="space-y-4">

                        <div class="text-xs font-semibold tracking-widest text-blue-600 uppercase">
                            Exam Target
                        </div>

                        <h2 id="examName"
                            class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 tracking-tight">
                            SSC CGL 2026 Tier 1
                        </h2>

                        <div class="flex justify-between items-start gap-6 text-sm text-gray-600 w-full max-w-xs">

                            <div class="flex-1 min-w-0">
                                <p class="text-xs text-gray-500">
                                    Attempt Year
                                </p>
                                <p id="attemptYear" class="font-semibold text-gray-900 mt-1">
                                    2026
                                </p>
                            </div>

                            <div class="flex-1 min-w-0 text-right">
                                <p class="text-xs text-gray-500">
                                    Exam Date
                                </p>
                                <p id="examDateText" class="font-semibold text-gray-900 mt-1">
                                    01 Aug 2026
                                </p>
                            </div>

                        </div>

                    </div>

                    <!-- DIVIDER (Desktop Only) -->
                    <div class="hidden lg:block h-20 w-px bg-gray-200"></div>
                    <div
                        class="block sm:hidden h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent my-2">
                    </div>

                    <!-- RIGHT SIDE COUNTDOWN -->
                    <div class="w-full lg:w-auto">

                        <div class="text-center lg:text-right">

                            <div id="daysLeft" class="text-4xl sm:text-5xl font-bold text-blue-700 tracking-tight">
                                000
                            </div>

                            <div class="text-xs uppercase tracking-widest text-gray-500 mt-2">
                                Days Remaining
                            </div>

                            <div id="urgencyText"
                                class="text-xs text-gray-500 mt-3 leading-relaxed max-w-xs mx-auto lg:mx-0">
                            </div>

                        </div>

                    </div>

                </div>


            </div>

        </div>

        <!-- ================= DAILY STUDY TRACKER ================= -->
        <div id="studyTrackerCard" class="mb-10 bg-white border border-gray-200
            rounded-xl p-6 shadow-sm hover:shadow-md
            transition-all duration-300">

            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 tracking-tight">
                        Daily Study Tracker
                    </h2>
                    <p class="text-xs text-gray-500 mt-1">
                        Track consistency and maintain your preparation streak.
                    </p>
                </div>

                <!-- Streak Badge -->
                <div class="text-right">
                    <p id="streakCount" class="text-2xl font-bold text-indigo-700 leading-none">
                        0
                    </p>
                    <p class="text-xs text-gray-500">
                        Day Streak
                    </p>
                </div>
            </div>

            <!-- Stats Row -->
            <div class="grid grid-cols-2 gap-6 mb-6">

                <!-- Goal -->
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                    <p class="text-xs text-gray-500 uppercase tracking-wide">
                        Today's Goal
                    </p>
                    <p id="dailyGoal" class="text-lg font-semibold text-gray-900 mt-1">
                        4 Hours
                    </p>
                </div>

                <!-- Completed -->
                <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                    <p class="text-xs text-blue-600 uppercase tracking-wide">
                        Completed
                    </p>
                    <p id="hoursCompleted" class="text-lg font-semibold text-blue-700 mt-1">
                        0 Hours
                    </p>
                </div>

            </div>

            <!-- Progress -->
            <div>
                <div class="flex justify-between text-xs text-gray-500 mb-2">
                    <span>Progress</span>
                    <span id="progressPercentText">0%</span>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-600 to-indigo-600
                        h-2 rounded-full transition-all duration-500" style="width: 0%">
                    </div>
                </div>

                <p id="goalStatus" class="text-xs mt-3 text-gray-500">
                </p>
            </div>

            <!-- Log Study Hours -->
            <div class="mt-6 flex gap-3 items-center">
                <input type="number" id="studyInput" min="0" step="0.5" placeholder="Enter hours"
                    class="w-32 px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none" />

                <button onclick="logStudyHours()" class="bg-gradient-to-r from-blue-600 to-indigo-600
               text-white px-4 py-2 rounded-lg text-sm font-medium
               hover:from-blue-700 hover:to-indigo-700 transition">
                    Save
                </button>
            </div>

        </div>

        <!-- ================= WEEKLY CONSISTENCY ================= -->
        <div id="weeklyConsistencyCard" class="mb-12 bg-white border border-gray-200
            rounded-xl p-6 shadow-sm hover:shadow-md
            transition-all duration-300">

            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-900 tracking-tight">
                    Weekly Consistency
                </h2>
                <p class="text-xs text-gray-500 mt-1">
                    Maintain discipline. Study every day.
                </p>
            </div>

            <div class="grid grid-cols-7 gap-3 text-center text-xs font-medium">

                <div class="space-y-2">
                    <div class="text-gray-500">Mon</div>
                    <div id="day1" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Tue</div>
                    <div id="day2" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Wed</div>
                    <div id="day3" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Thu</div>
                    <div id="day4" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Fri</div>
                    <div id="day5" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Sat</div>
                    <div id="day6" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

                <div class="space-y-2">
                    <div class="text-gray-500">Sun</div>
                    <div id="day7" class="h-8 rounded-md flex items-center justify-center bg-gray-100"></div>
                </div>

            </div>
        </div>

        <!-- ================= MY SUPPORT REQUESTS ================= -->
        <div id="supportRequestsCard" class="mb-12 bg-white border border-gray-200
    rounded-xl p-6 shadow-sm hover:shadow-md
    transition-all duration-300 hidden">

            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-900 tracking-tight">
                    My Support Requests
                </h2>
                <p class="text-xs text-gray-500 mt-1">
                    Track the status of your submitted queries.
                </p>
            </div>

            <div id="supportList" class="space-y-4">
                <!-- Tickets will load here -->
            </div>

        </div>

        <!-- SUPPORT MODAL -->
        <div id="ticketModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-50">

            <div class="flex items-center justify-center min-h-screen px-4 py-8">

                <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl relative
                    max-h-[90vh] overflow-hidden flex flex-col">

                    <!-- Header -->
                    <div class="flex items-center justify-between px-5 py-4 border-b">

                        <div class="flex items-center gap-3">
                            <h3 class="text-lg font-semibold text-gray-900">
                                Support Ticket
                            </h3>
                            <div id="responseBadge"></div>
                        </div>

                        <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 text-lg">
                            âœ•
                        </button>

                    </div>

                    <!-- Body -->
                    <div id="modalContent" class="p-5 space-y-5 overflow-y-auto text-sm flex-1">
                    </div>

                </div>

            </div>
        </div>





        <!-- Enrollment Card -->
        <div id="coursesContainer"
            class="grid sm:grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 hidden opacity-0 transition-opacity duration-500">


            <!-- No Enrollment -->
            <div id="noEnrollment" class="bg-white shadow-lg rounded-xl p-8 text-center hidden">

                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    You are not enrolled in any course yet.
                </h2>

                <a href="enroll.html" class="bg-gradient-to-r from-blue-500 to-indigo-500
                text-white px-6 py-3 rounded-full font-semibold">
                    Enroll Now
                </a>

            </div>
        </div>

        <!-- Toast Notification -->
        <div id="customToast" class="fixed top-[80px] sm:top-[90px] right-5 hidden z-[9999] max-w-[95%] sm:max-w-sm">

            <div id="toastBox" class="flex items-center gap-3 bg-white shadow-xl rounded-lg px-4 py-3 border-l-4">

                <div id="toastIcon"></div>

                <p id="toastMessage" class="text-gray-800 text-sm font-medium"></p>

            </div>
        </div>
        <style>
            @keyframes slideInRight {
                from {
                    transform: translateX(120%);
                    opacity: 0;
                }

                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }

                to {
                    transform: translateX(120%);
                    opacity: 0;
                }
            }

            .toast-in {
                animation: slideInRight 0.35s ease-out forwards;
            }

            .toast-out {
                animation: slideOutRight 0.3s ease-in forwards;
            }
        </style>

        <!-- MOBILE NOTIFICATION PANEL -->
        <!-- MOBILE BOTTOM SHEET -->
        <div id="mobileNotificationPanel" class="fixed inset-0 z-50 hidden">

            <!-- Overlay -->
            <div id="mobileOverlay" class="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>

            <!-- Bottom Sheet -->
            <div id="mobileSheet" class="absolute bottom-0 left-0 right-0
        bg-white rounded-t-2xl
        max-h-[75vh]
        flex flex-col
        transform translate-y-full
        transition-transform duration-300">

                <!-- Handle -->
                <div class="flex justify-center py-2">
                    <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
                </div>

                <!-- Header -->
                <div class="flex items-center justify-between px-5 py-3 border-b">

                    <h3 class="text-base font-semibold">
                        Notifications
                    </h3>

                    <div class="flex items-center gap-4">

                        <button id="mobileMarkAllRead" class="text-xs text-blue-600 font-medium hover:underline">
                            Mark all
                        </button>

                        <button id="closeMobileNotifications" class="text-gray-500 text-lg">
                            âœ•
                        </button>

                    </div>
                </div>

                <!-- List -->
                <div id="mobileNotificationList" class="flex-1 overflow-y-auto divide-y divide-gray-100">
                </div>

                <!-- Footer -->
                <a href="notifications.html" class="block w-full text-center 
   text-sm font-medium text-gray-700 py-2 border-t rounded-lg transition">
                    View All Notifications
                </a>

            </div>
        </div>
    </main>

    <!-- ================= FOOTER (Same as index) ================= -->
    <!-- Footer -->
    <footer class="bg-gradient-to-r from-blue-700 to-indigo-700 text-gray-100 py-5 mt-auto">
        <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <p class="mb-4 md:mb-0">&copy; 2026 Courage Library. All rights reserved.</p>
            <div class="flex space-x-6">
                <a href="https://www.facebook.com/people/Courage-Library/61561969000820/?mibextid=ZbWKwL"
                    target="_blank" class="hover:text-white text-2xl"><i class="fab fa-facebook-f"></i></a>
                <a href="https://x.com/CourageLibrary" target="_blank" class="hover:text-white text-2xl"><i
                        class="fab fa-twitter"></i></a>
                <a href="https://www.linkedin.com/company/courage-library" target="_blank"
                    class="hover:text-white text-2xl"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.instagram.com/couragelibrary1" target="_blank" class="hover:text-white text-2xl"><i
                        class="fab fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <script>
        /* ================= SUPABASE ================= */

        const supaClient = window.supabase.createClient(
            'https://sgagswxzsxlgcspwiuoh.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnYWdzd3h6c3hsZ2NzcHdpdW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NTA1NTIsImV4cCI6MjA2OTUyNjU1Mn0.ZNfk5WNDPkjKcFsRO48rEYk3dhbLYm_m21aZ-wfywo4'
        );

        async function loadDashboard() {

            const { data: { session } } = await supaClient.auth.getSession();

            if (!session) {
                showToast("Please login first.", "error");
                setTimeout(() => {
                    window.location.href = "index.html?checkAuth=1";
                }, 1200);
                return;
            }

            const user = session.user;

            const { data: unread } = await supaClient
                .from("notifications")
                .select("id")
                .eq("user_id", user.id)
                .eq("is_read", false);

            const desktopBadge = document.getElementById("notificationCount");
            const mobileDot = document.getElementById("mobileHamburgerDot");
            const mobileDropdownBadge = document.getElementById("mobileMenuNotificationCount");

            if (unread && unread.length > 0) {

                desktopBadge.textContent = unread.length;
                desktopBadge.classList.remove("hidden");

                mobileDot.classList.remove("hidden");

                mobileDropdownBadge.textContent = unread.length;
                mobileDropdownBadge.classList.remove("hidden");

            } else {

                desktopBadge.classList.add("hidden");
                mobileDot.classList.add("hidden");
                mobileDropdownBadge.classList.add("hidden");
            }

            supaClient
                .channel('realtime-notifications')
                .on(
                    'postgres_changes',
                    {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'notifications',
                        filter: `user_id=eq.${user.id}`
                    },
                    (payload) => {

                        showToast(payload.new.title, "success");

                        const desktopBadge = document.getElementById("notificationCount");
                        const mobileDot = document.getElementById("mobileHamburgerDot");
                        const mobileDropdownBadge = document.getElementById("mobileMenuNotificationCount");

                        let currentCount = Number(desktopBadge.textContent);
                        if (isNaN(currentCount)) currentCount = 0;

                        let count = currentCount + 1;

                        desktopBadge.textContent = count;
                        desktopBadge.classList.remove("hidden");

                        mobileDot.classList.remove("hidden");

                        mobileDropdownBadge.textContent = count;
                        mobileDropdownBadge.classList.remove("hidden");

                    }
                )
                .subscribe();

            /* ================= USER PROFILE ================= */

            const { data: profile, error: profileError } = await supaClient
                .from("user_profiles")
                .select("*")
                .eq("id", user.id)
                .single();

            if (profileError) {
                console.error("Profile fetch error:", profileError);
            }


            // ðŸ”Ž Get latest enrollment (NO .single())
            const { data: enrollments, error } = await supaClient
                .from("student_enrollments")
                .select("*")
                .eq("user_id", user.id)
                .order("enrolled_at", { ascending: false });

            let enrollment = enrollments && enrollments.length > 0
                ? enrollments[0]
                : null;

            let formattedName = "User";

            if (profile && profile.full_name) {
                formattedName = profile.full_name
                    .split(" ")
                    .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
                    .join(" ");
            }

            // Dynamic Greeting
            const hour = new Date().getHours();
            let greeting = "Welcome";

            if (hour < 12) greeting = "Good Morning";
            else if (hour < 18) greeting = "Good Afternoon";
            else greeting = "Good Evening";

            document.getElementById("welcomeHeading").innerHTML =
                `${greeting}, <span class="text-blue-700">${formattedName}</span>`;

            const heading = document.getElementById("welcomeHeading");
            requestAnimationFrame(() => {
                heading.classList.remove("opacity-0");
            });

            /* ================= SUPPORT REQUESTS ================= */

            const { data: tickets } = await supaClient
                .from("support_tickets")
                .select("*")
                .eq("user_id", user.id)
                .order("created_at", { ascending: false });

            if (tickets && tickets.length > 0) {

                document.getElementById("supportRequestsCard").classList.remove("hidden");

                const supportList = document.getElementById("supportList");
                supportList.innerHTML = "";

                tickets.forEach(ticket => {

                    let statusColor = "bg-yellow-50 text-yellow-700 border border-yellow-200";
                    let statusText = ticket.status || "Open";

                    if (statusText === "resolved") {
                        statusColor = "bg-green-50 text-green-700 border border-green-200";
                    } else if (statusText === "in_progress") {
                        statusColor = "bg-blue-50 text-blue-700 border border-blue-200";
                    }

                    const formattedDate = new Date(ticket.created_at)
                        .toLocaleDateString("en-GB", {
                            day: "2-digit",
                            month: "short",
                            year: "numeric"
                        });

                    supportList.innerHTML += `
<div class="flex justify-between items-center border border-gray-100
    rounded-lg px-4 py-3 bg-gray-50 hover:bg-gray-100 transition">

    <div>
        <p class="text-sm font-medium text-gray-900">
            #${ticket.id.slice(0, 8)}
        </p>
        <p class="text-xs text-gray-500 mt-1">
            ${ticket.category} â€¢ ${formattedDate}
        </p>
    </div>

    <div class="flex items-center gap-3">
        <span class="text-xs font-semibold px-3 py-1 rounded-full ${statusColor}">
            ${statusText.replace("_", " ")}
        </span>

        <button onclick='openTicketModal(${JSON.stringify(ticket)})'
            class="text-xs text-blue-600 font-semibold hover:underline">
            View
        </button>
    </div>

</div>
`;
                });
            }

            /* ================= EXAM TARGET ================= */

            if (profile && profile.exam_date) {

                const examDate = new Date(profile.exam_date);
                const todayDate = new Date();

                const timeDiff = examDate.getTime() - todayDate.getTime();
                const examDaysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

                document.getElementById("examTargetCard").classList.remove("hidden");

                // Exam Name
                document.getElementById("examName").textContent =
                    profile.exam_name || "Target Exam";

                // Attempt Year
                document.getElementById("attemptYear").textContent =
                    examDate.getFullYear();

                // Exam Date Text
                document.getElementById("examDateText").textContent =
                    examDate.toLocaleDateString("en-GB", {
                        day: "2-digit",
                        month: "short",
                        year: "numeric"
                    });

                // Days Left
                document.getElementById("daysLeft").textContent =
                    examDaysLeft > 0 ? examDaysLeft : 0;

                // Urgency Logic
                if (examDaysLeft > 90) {
                    document.getElementById("urgencyText").textContent =
                        "You have time. Build strong fundamentals.";
                } else if (examDaysLeft > 30) {
                    document.getElementById("urgencyText").textContent =
                        "Focus on revision and mock tests.";
                } else if (examDaysLeft > 0) {
                    document.getElementById("urgencyText").textContent =
                        "Final phase. Daily full-length mock required.";
                } else {
                    document.getElementById("urgencyText").textContent =
                        "Exam window is active or completed.";
                }
            }


            /* ================= DAILY STUDY TRACKER ================= */

            const nowLocal = new Date();

            const year = nowLocal.getFullYear();
            const month = String(nowLocal.getMonth() + 1).padStart(2, "0");
            const day = String(nowLocal.getDate()).padStart(2, "0");

            const today = `${year}-${month}-${day}`;

            // Get today's study session
            const { data: todaySession } = await supaClient
                .from("study_sessions")
                .select("*")
                .eq("user_id", user.id)
                .eq("study_date", today)
                .maybeSingle();

            const hoursStudiedToday = todaySession?.hours_studied || 0;

            // Goal from profile
            const dailyGoalHours = profile?.daily_goal_hours || 4;

            // Display goal
            document.getElementById("dailyGoal").textContent =
                dailyGoalHours + " Hours";

            // Display completed
            document.getElementById("hoursCompleted").textContent =
                hoursStudiedToday + " Hours";

            // Progress calculation
            const progressPercent = Math.min(
                (hoursStudiedToday / dailyGoalHours) * 100,
                100
            );

            document.getElementById("progressBar").style.width =
                progressPercent + "%";

            document.getElementById("progressPercentText").textContent =
                Math.round(progressPercent) + "%";

            if (progressPercent >= 100) {
                document.getElementById("goalStatus").textContent =
                    "Daily goal achieved. Maintain momentum.";
            } else {
                document.getElementById("goalStatus").textContent =
                    "Stay consistent. Complete today's target.";
            }

            /* ================= WEEKLY CONSISTENCY ================= */

            // Helper to format LOCAL date (not UTC)
            function formatLocalDate(date) {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, "0");
                const d = String(date.getDate()).padStart(2, "0");
                return `${y}-${m}-${d}`;
            }

            // Get current date
            const now = new Date();

            // Get Monday of current week
            const dayOfWeek = now.getDay(); // 0 = Sun
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;

            const monday = new Date(now);
            monday.setDate(now.getDate() + mondayOffset);

            // Build week array (Mon â†’ Sun) using LOCAL date
            const weekDates = [];

            for (let i = 0; i < 7; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                weekDates.push(formatLocalDate(d));
            }

            // Fetch sessions for this week
            const { data: weeklySessions } = await supaClient
                .from("study_sessions")
                .select("study_date, hours_studied")
                .eq("user_id", user.id)
                .in("study_date", weekDates);

            // Update UI correctly (Mon=day1 ... Sun=day7)
            weekDates.forEach((date, index) => {

                const dayBox = document.getElementById("day" + (index + 1));

                const session = weeklySessions?.find(s => s.study_date === date);

                if (session && session.hours_studied > 0) {
                    dayBox.innerHTML = "âœ“";
                    dayBox.className = "h-8 rounded-md flex items-center justify-center text-xs sm:text-sm font-semibold bg-green-100 text-green-700";

                } else {
                    dayBox.innerHTML = "âœ•";
                    dayBox.className = "h-8 rounded-md flex items-center justify-center text-xs sm:text-sm font-semibold bg-red-100 text-red-600";

                }
            });

            /* ================= STREAK CALCULATION ================= */

            let streak = 0;

            // Check from today backwards
            for (let i = weekDates.length - 1; i >= 0; i--) {

                const date = weekDates[i];
                const session = weeklySessions?.find(s => s.study_date === date);

                if (session && session.hours_studied > 0) {
                    streak++;
                } else {
                    break;
                }
            }

            document.getElementById("streakCount").textContent =
                profile?.current_streak || 0;

            // Initials from full name
            const initials = formattedName
                .split(" ")
                .map(w => w[0])
                .join("")
                .substring(0, 2)
                .toUpperCase();

            // Apply everywhere
            document.getElementById("userInitials").textContent = initials;
            document.getElementById("menuInitials").textContent = initials;
            document.getElementById("mobileInitials").textContent = initials;
            document.getElementById("menuUserName").textContent = formattedName;
            document.getElementById("mobileUserName").textContent = formattedName;

            if (enrollments && enrollments.length > 0) {

                const container = document.getElementById("coursesContainer");
                container.innerHTML = "";
                container.classList.remove("hidden");

                requestAnimationFrame(() => {
                    container.classList.remove("opacity-0");
                });

                container.classList.remove("hidden");

                setTimeout(() => {
                    container.style.opacity = 1;
                }, 50);

                enrollments.forEach(course => {

                    const today = new Date();
                    const validDate = new Date(course.valid_till);
                    const diffTime = validDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    const formattedDate = new Date(course.valid_till).toLocaleDateString("en-GB", {
                        day: "2-digit",
                        month: "short",
                        year: "numeric"
                    });

                    let statusColor = "bg-green-50 text-green-600 border border-green-200";
                    let statusText = "Active";

                    if (diffDays <= 0) {
                        statusColor = "bg-red-50 text-red-600 border border-red-200";
                        statusText = "Expired";
                    } else if (diffDays <= 5) {
                        statusColor = "bg-yellow-50 text-yellow-600 border border-yellow-200";
                        statusText = "Expiring Soon";
                    }

                    const card = `
        <div class="bg-white/80 backdrop-blur-md border border-gray-200
            rounded-xl p-6 shadow-md hover:shadow-xl
            transition-all duration-300 hover:-translate-y-1
            hover:border-blue-300 hover:cursor-pointer">

            <div class="flex justify-between items-start mb-4">
                <h2 class="text-lg font-semibold text-gray-900 tracking-tight">
                    ${course.course_name}
                </h2>

                <span class="inline-flex items-center px-3 py-1 text-xs font-semibold rounded-full ${statusColor}">
                    ${statusText}
                </span>
            </div>

            <p class="text-gray-500 text-sm mb-2">
                ${course.plan_name}
            </p>

            <p class="text-sm text-gray-600 mb-4">
                Valid Till:
                <span class="font-semibold text-blue-700">
                    ${formattedDate}
                </span>
            </p>

            <div class="flex items-center justify-between gap-4 mt-6">

                <span class="text-sm text-gray-500 flex-1 min-w-0 truncate">
                    ${diffDays > 0 ? `${diffDays} days remaining` : "Plan expired"}
                </span>

                <a href="${course.course_name.replace(/\s+/g, "-")}.html"
                class="shrink-0 bg-gradient-to-r from-blue-600 to-indigo-600
                        text-white px-4 py-1.5 rounded-md text-xs font-medium
                        shadow-sm hover:shadow transition hover:from-blue-700 hover:to-indigo-700">
                    Continue
                </a>

            </div>
        </div>
    `;

                    container.innerHTML += card;
                });
            } else {
                document.getElementById("noEnrollment").classList.remove("hidden");
            }

        }

        async function logout() {
            await supaClient.auth.signOut();
            window.location.href = "index.html";
        }

        loadDashboard();


        /* Profile Dropdown */

        const profileBtn = document.getElementById("profileBtn");
        const profileMenu = document.getElementById("profileMenu");

        profileBtn.addEventListener("click", (e) => {
            e.stopPropagation();

            if (profileMenu.classList.contains("pointer-events-none")) {
                profileMenu.classList.remove("opacity-0", "scale-95", "pointer-events-none");
                profileMenu.classList.add("opacity-100", "scale-100");
            } else {
                profileMenu.classList.add("opacity-0", "scale-95", "pointer-events-none");
                profileMenu.classList.remove("opacity-100", "scale-100");
            }
        });

        document.addEventListener("click", (e) => {
            if (!profileBtn.contains(e.target) &&
                !profileMenu.contains(e.target)) {

                profileMenu.classList.add("opacity-0", "scale-95", "pointer-events-none");
                profileMenu.classList.remove("opacity-100", "scale-100");
            }
        });

        async function logStudyHours() {

            const input = document.getElementById("studyInput");
            const hours = parseFloat(input.value);

            if (!hours || hours <= 0) {
                showToast("Please enter valid study hours.", "error");
                return;
            }

            const { data: { session } } = await supaClient.auth.getSession();
            const user = session.user;

            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, "0");
            const day = String(now.getDate()).padStart(2, "0");
            const today = `${year}-${month}-${day}`;

            const yesterdayDate = new Date(now);
            yesterdayDate.setDate(now.getDate() - 1);

            const yYear = yesterdayDate.getFullYear();
            const yMonth = String(yesterdayDate.getMonth() + 1).padStart(2, "0");
            const yDay = String(yesterdayDate.getDate()).padStart(2, "0");
            const yesterday = `${yYear}-${yMonth}-${yDay}`;

            // Check if already logged today
            const { data: todaySessions } = await supaClient
                .from("study_sessions")
                .select("id")
                .eq("user_id", user.id)
                .eq("study_date", today);

            const isFirstLogToday = !todaySessions || todaySessions.length === 0;

            // Save / update session
            const { error } = await supaClient
                .from("study_sessions")
                .upsert({
                    user_id: user.id,
                    study_date: today,
                    hours_studied: hours
                }, {
                    onConflict: ["user_id", "study_date"]
                });

            if (error) {
                console.error(error);
                showToast("Error saving study hours.", "error");
                return;
            }

            input.value = "";
            showToast("Study hours saved successfully.", "success");
            loadDashboard();
        }

        function showToast(message, type = "info") {

            const toast = document.getElementById("customToast");
            const box = document.getElementById("toastBox");
            const icon = document.getElementById("toastIcon");
            const msg = document.getElementById("toastMessage");

            msg.textContent = message;

            box.classList.remove("border-blue-500", "border-green-500", "border-red-500");

            if (type === "success") {
                box.classList.add("border-green-500");
                icon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5 text-green-600"
                fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"/>
            </svg>`;
            }
            else if (type === "error") {
                box.classList.add("border-red-500");
                icon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5 text-red-600"
                fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"/>
            </svg>`;
            }
            else {
                box.classList.add("border-blue-500");
                icon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5 text-blue-600"
                fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01"/>
            </svg>`;
            }

            toast.classList.remove("hidden");
            box.classList.remove("toast-out");
            box.classList.add("toast-in");

            setTimeout(() => {
                box.classList.remove("toast-in");
                box.classList.add("toast-out");

                setTimeout(() => {
                    toast.classList.add("hidden");
                }, 300);
            }, 3000);
        }

        function openTicketModal(ticket) {

            const modal = document.getElementById("ticketModal");
            const content = document.getElementById("modalContent");
            const closeBtn = document.getElementById("closeModalBtn");

            closeBtn.addEventListener("click", () => {
                modal.classList.add("hidden");
            });
            modal.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                }
            });

            const createdDate = new Date(ticket.created_at);
            const updatedDate = new Date(ticket.updated_at);

            const formattedCreated = createdDate.toLocaleDateString("en-GB", {
                day: "2-digit",
                month: "short",
                year: "numeric"
            });

            // Calculate response time
            let responseTimeText = "â€”";

            if (ticket.admin_reply) {

                const diffMs = updatedDate - createdDate;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffMinutes = Math.floor((diffMs / (1000 * 60)) % 60);

                if (diffHours > 0) {
                    responseTimeText = `${diffHours}h ${diffMinutes}m`;
                } else {
                    responseTimeText = `${diffMinutes} minutes`;
                }
            }

            const badgeContainer = document.getElementById("responseBadge");

            if (ticket.admin_reply) {

                badgeContainer.innerHTML = `
        <span class="bg-green-50 text-green-700 
px-2 py-0.5 text-[11px]
sm:px-3 sm:py-1 sm:text-xs
rounded-full font-medium">
            Responded in ${responseTimeText}
        </span>
    `;

            } else {

                badgeContainer.innerHTML = `
        <span class="bg-yellow-50 text-yellow-700
            px-3 py-1 rounded-full text-xs font-medium">
            Awaiting response
        </span>
    `;
            }

            content.innerHTML = `
    <!-- META STRIP -->
<div class="border-b pb-4">

    <div class="flex flex-wrap items-center justify-between gap-6 text-sm">

        <div class="space-y-1">
            <p class="text-xs text-gray-400 uppercase tracking-wide">Ticket</p>
            <p class="font-semibold text-gray-900">
                #${ticket.id.slice(0, 8)}
            </p>
        </div>

        <div class="space-y-1">
            <p class="text-xs text-gray-400 uppercase tracking-wide">Category</p>
            <p class="text-gray-800">
                ${ticket.category}
            </p>
        </div>

        <div class="space-y-1">
            <p class="text-xs text-gray-400 uppercase tracking-wide">Submitted</p>
            <p class="text-gray-800">
                ${formattedCreated}
            </p>
        </div>

    </div>

</div>

    <!-- CONVERSATION -->
    <div class="space-y-4">

        <!-- User Message -->
        <div class="bg-gray-100 p-4 rounded-xl border">
            <p class="text-xs text-gray-500 mb-2">
                You
            </p>
            <p class="text-gray-800">
                ${ticket.message}
            </p>
        </div>

        ${ticket.admin_reply
                    ? `
            <!-- Admin Response -->
            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                <p class="text-xs text-green-600 font-semibold mb-2">
                    Courage Library Support
                </p>
                <p class="text-green-800">
                    ${ticket.admin_reply}
                </p>
            </div>
            `
                    : ""
                }

    </div>
`;

            modal.classList.remove("hidden");
        }

        const bell = document.getElementById("notificationBell");
        const dropdown = document.getElementById("notificationDropdown");

        bell.addEventListener("click", async (e) => {

            e.stopPropagation();

            if (window.innerWidth < 768) {
                // Mobile
                const panel = document.getElementById("mobileNotificationPanel");
                panel.classList.remove("hidden");
                panel.classList.add("flex");

                await loadMobileNotifications();

            } else {
                // Desktop
                dropdown.classList.toggle("hidden");

                if (!dropdown.classList.contains("hidden")) {
                    await loadNotificationPreview();
                }
            }
        });

        document.addEventListener("click", (e) => {
            if (!bell.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.add("hidden");
            }
        });

        async function loadNotificationPreview() {

            const { data: { session } } = await supaClient.auth.getSession();
            const user = session.user;

            const { data } = await supaClient
                .from("notifications")
                .select("*")
                .eq("user_id", user.id)
                .order("created_at", { ascending: false })
                .limit(5);

            const list = document.getElementById("notificationList");
            list.innerHTML = "";

            if (!data || data.length === 0) {
                list.innerHTML = `
            <div class="p-4 text-sm text-gray-500 text-center">
                No notifications yet
            </div>
        `;
                return;
            }

            data.forEach(n => {

                list.innerHTML += `
            <div class="px-4 py-3 hover:bg-gray-50 cursor-pointer
                ${n.is_read ? "" : "bg-blue-50"}">

                <p class="text-sm font-medium text-gray-900">
                    ${n.title}
                </p>

                <p class="text-xs text-gray-500 mt-1">
                    ${n.message}
                </p>

                <p class="text-[11px] text-gray-400 mt-1">
                    ${new Date(n.created_at).toLocaleString("en-GB", {
                    day: "2-digit",
                    month: "short",
                    year: "numeric",
                    hour: "numeric",
                    minute: "2-digit"
                }).replace(",", " â€¢")}
                </p>

            </div>
        `;
            });
        }

        async function loadMobileNotifications() {

            const { data: { session } } = await supaClient.auth.getSession();
            const user = session.user;

            const { data } = await supaClient
                .from("notifications")
                .select("*")
                .eq("user_id", user.id)
                .order("created_at", { ascending: false });

            const list = document.getElementById("mobileNotificationList");
            list.innerHTML = "";

            if (!data || data.length === 0) {
                list.innerHTML = `
            <div class="p-6 text-center text-gray-500">
                No notifications yet
            </div>
        `;
                return;
            }

            data.forEach(n => {

                list.innerHTML += `
            <div class="px-5 py-4 ${n.is_read ? "" : "bg-blue-50"}">

                <p class="text-sm font-semibold text-gray-900">
                    ${n.title}
                </p>

                <p class="text-sm text-gray-600 mt-1">
                    ${n.message}
                </p>

                <p class="text-xs text-gray-400 mt-2">
                    ${new Date(n.created_at).toLocaleString("en-GB", {
                    day: "2-digit",
                    month: "short",
                    year: "numeric",
                    hour: "numeric",
                    minute: "2-digit"
                }).replace(",", " â€¢")}
                </p>

            </div>
        `;
            });
        }

        document.getElementById("markAllReadBtn")
            .addEventListener("click", async () => {

                const { data: { session } } = await supaClient.auth.getSession();
                const user = session.user;

                await supaClient
                    .from("notifications")
                    .update({ is_read: true })
                    .eq("user_id", user.id)
                    .eq("is_read", false);

                document.getElementById("notificationCount").classList.add("hidden");
                document.getElementById("mobileHamburgerDot").classList.add("hidden");
                document.getElementById("mobileMenuNotificationCount").classList.add("hidden");

                await loadNotificationPreview();
            });

        document.getElementById("mobileMarkAllRead")
            .addEventListener("click", async () => {

                const { data: { session } } = await supaClient.auth.getSession();
                const user = session.user;

                await supaClient
                    .from("notifications")
                    .update({ is_read: true })
                    .eq("user_id", user.id)
                    .eq("is_read", false);

                // Hide all badges
                document.getElementById("notificationCount").classList.add("hidden");
                document.getElementById("mobileHamburgerDot").classList.add("hidden");
                document.getElementById("mobileMenuNotificationCount").classList.add("hidden");

                // Smoothly close bottom sheet
                closeMobileNotifications();
            });

        function openMobileNotifications() {

            const panel = document.getElementById("mobileNotificationPanel");
            const sheet = document.getElementById("mobileSheet");

            panel.classList.remove("hidden");

            requestAnimationFrame(() => {
                sheet.classList.remove("translate-y-full");
            });

            loadMobileNotifications();
        }

        function closeMobileNotifications() {

            const panel = document.getElementById("mobileNotificationPanel");
            const sheet = document.getElementById("mobileSheet");

            sheet.classList.add("translate-y-full");

            setTimeout(() => {
                panel.classList.add("hidden");
            }, 300);
        }

        document.getElementById("closeMobileNotifications")
            .addEventListener("click", closeMobileNotifications);

        document.getElementById("mobileOverlay")
            .addEventListener("click", closeMobileNotifications);
    </script>

</body>

</html>