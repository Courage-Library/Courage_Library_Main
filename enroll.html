<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enroll Now | Courage Library</title>
  <link rel="icon" type="image/png" href="/images/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body class="bg-gray-50 text-gray-900 flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="bg-white/90 backdrop-blur-lg shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="flex items-center space-x-2">
        <img src="/images/logo.png" alt="Logo" class="w-8 h-8">
        <span class="text-2xl font-bold text-blue-700">Courage Library</span>
      </a>
      <div class="hidden md:flex space-x-6">
        <a href="index.html#features" class="hover:text-blue-600">Features</a>
        <a href="index.html#courses" class="hover:text-blue-600">Courses</a>
        <a href="index.html#testimonials" class="hover:text-blue-600">Testimonials</a>
        <a href="Blog/Blog.html" class="hover:text-blue-600">Blog</a>
        <a href="index.html#contact" class="hover:text-blue-600">Contact</a>
        <a href="index.html"
          class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 rounded-full shadow hover:scale-110 transition">
          Home
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Section -->
  <main class="flex-grow flex justify-center items-center px-4 py-12">
    <div
      class="bg-white/90 backdrop-blur-xl border border-gray-200 p-8 md:p-10 rounded-2xl shadow-2xl w-full max-w-md text-center">
      <h1 class="text-3xl font-bold text-blue-700 mb-4">Enroll Now</h1>
      <p class="text-gray-600 mb-6 text-sm">Choose your course and complete the details below to begin your journey
        with Courage Library.</p>

      <form id="enrollForm" class="space-y-4 text-left" x-data>

        <!-- Course Dropdown -->
        <div x-data="{ open: false, selected: '' }" class="relative">
          <label class="block text-sm font-medium text-gray-600 mb-1">Select Course<span class="text-blue-600">
              *</span></label>
          <button type="button" @click="open = !open"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
            <span x-text="selected || 'Choose a Course'" class="text-gray-700"></span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': open }">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div x-show="open" @click.outside="open=false"
            class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
            <div @click="selected='SSC CGL'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC CGL</div>
            <div @click="selected='SSC MTS'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC MTS</div>
            <div @click="selected='SSC GD'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC GD</div>
            <div @click="selected='Delhi Police'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Delhi
              Police</div>
          </div>
          <input type="hidden" name="course_name" :value="selected">
        </div>

        <!-- Full Name -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Full Name<span class="text-blue-600">
              *</span></label>
          <input type="text" name="full_name" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Gender Dropdown -->
        <div x-data="{ open: false, selected: '' }" class="relative">
          <label class="block text-sm font-medium text-gray-600 mb-1">Gender<span class="text-blue-600">
              *</span></label>
          <button type="button" @click="open = !open"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
            <span x-text="selected || 'Select Gender'" class="text-gray-700"></span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': open }">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div x-show="open" @click.outside="open=false"
            class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
            <div @click="selected='Male'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Male</div>
            <div @click="selected='Female'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Female</div>
            <div @click="selected='Other'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Other</div>
          </div>
          <input type="hidden" name="gender" :value="selected">
        </div>

        <!-- DOB Dropdown (Day, Month, Year) -->
        <div x-data="{ day:'', month:'', year:'', openDay:false, openMonth:false, openYear:false }">
          <label class="block text-sm font-medium text-gray-600 mb-2">Date of Birth<span class="text-blue-600">
              *</span></label>
          <div class="grid grid-cols-3 gap-2">
            <!-- Day -->
            <div class="relative">
              <button type="button" @click="openDay=!openDay"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="day || 'Day'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openDay }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openDay" @click.outside="openDay=false"
                class="absolute mt-2 w-full max-h-40 overflow-y-auto bg-white border rounded-lg shadow-lg z-10">
                <template x-for="d in 31" :key="d">
                  <div @click="day=d;openDay=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="d"></div>
                </template>
              </div>
            </div>

            <!-- Month -->
            <div class="relative">
              <button type="button" @click="openMonth=!openMonth"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="month || 'Month'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openMonth }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openMonth" @click.outside="openMonth=false"
                class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
                <template x-for="m in ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']"
                  :key="m">
                  <div @click="month=m;openMonth=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="m">
                  </div>
                </template>
              </div>
            </div>

            <!-- Year -->
            <div class="relative">
              <button type="button" @click="openYear=!openYear"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="year || 'Year'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openYear }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openYear" @click.outside="openYear=false"
                class="absolute mt-2 w-full max-h-40 overflow-y-auto bg-white border rounded-lg shadow-lg z-10">
                <template x-for="y in Array.from({length:70},(_,i)=>new Date().getFullYear()-i)" :key="y">
                  <div @click="year=y;openYear=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="y">
                  </div>
                </template>
              </div>
            </div>
          </div>
          <input type="hidden" name="dob" :value="`${day}-${month}-${year}`">
        </div>

        <!-- Phone -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Phone Number<span class="text-blue-600">
              *</span></label>
          <input type="text" name="phone" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Qualification -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Qualification<span class="text-blue-600">
              *</span></label>
          <input type="text" name="qualification" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Address -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Address<span class="text-blue-600">
              *</span></label>
          <textarea name="address" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400"></textarea>
        </div>

        <!-- Pay Button -->
        <button id="payBtn" type="button"
          class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-md font-semibold hover:scale-105 transition">
          Pay Now ‚Çπ2
        </button>

        <p id="successMsg" class="hidden text-green-600 text-center font-semibold mt-3">Successfully Enrolled!</p>
      </form>
    </div>

    <!-- Success Popup Modal -->
    <div id="successPopup" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50"
      x-data="{ visible: false }" x-show="visible" x-transition>
      <div class="bg-white rounded-2xl p-8 text-center shadow-2xl max-w-sm w-full transform transition-all scale-100">
        <div class="flex justify-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-green-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 12l2 2l4-4m5 2a9 9 0 11-18 0a9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-green-600 mb-2">üéâ Congratulations!</h2>
        <p id="popupMessage" class="text-gray-700 mb-4">
          You have successfully enrolled!
        </p>
        <p class="text-sm text-gray-500">Redirecting you in 5 seconds...</p>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-blue-700 to-indigo-700 text-gray-100 py-5 mt-auto">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
      <p class="mb-4 md:mb-0">&copy; 2025 Courage Library. All rights reserved.</p>
      <div class="flex space-x-6">
        <a href="https://www.facebook.com/people/Courage-Library/61561969000820/?mibextid=ZbWKwL" target="_blank"
          class="hover:text-white text-2xl"><i class="fab fa-facebook-f"></i></a>
        <a href="https://x.com/CourageLibrary" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-twitter"></i></a>
        <a href="https://www.linkedin.com/company/courage-library" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-linkedin-in"></i></a>
        <a href="https://www.instagram.com/couragelibrary1" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-instagram"></i></a>
      </div>
    </div>
  </footer>

  <!-- Supabase -->
  <script>
    const SUPABASE_URL = "https://sgagswxzsxlgcspwiuoh.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnYWdzd3h6c3hsZ2NzcHdpdW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NTA1NTIsImV4cCI6MjA2OTUyNjU1Mn0.ZNfk5WNDPkjKcFsRO48rEYk3dhbLYm_m21aZ-wfywo4";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const payBtn = document.getElementById("payBtn");
    const successMsg = document.getElementById("successMsg");
    const form = document.getElementById("enrollForm");

    async function getCurrentUser() {
      const { data: session } = await supabase.auth.getSession();
      if (!session.session) {
        alert("‚ö†Ô∏è Please login first.");
        window.location.href = "index.html";
        return null;
      }
      return session.session.user;
    }

    payBtn.addEventListener("click", async () => {
      payBtn.textContent = "Processing...";
      payBtn.disabled = true;

      const user = await getCurrentUser();
      if (!user) return;

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.user_email = user.email;
      data.payment_status = "paid";

      // --- Razorpay Integration ---
      const options = {
        key: "rzp_live_RdymXUT2ibglux", // ‚ö†Ô∏è Replace with your own Razorpay Test Key
        amount: 2 * 100, // amount in paise (‚Çπ999)
        currency: "INR",
        name: "Courage Library",
        description: data.course_name + " Enrollment",
        image: "/images/logo.png",
        handler: async function (response) {
          // On successful payment
          data.payment_id = response.razorpay_payment_id;

          const { error } = await supabase.from("student_enrollments").insert([data]);
          if (error) {
            alert("‚ùå Error saving enrollment: " + error.message);
            payBtn.textContent = "Pay Now ‚Çπ999";
            payBtn.disabled = false;
            return;
          }

          // Personalized popup success
          const popup = document.getElementById("successPopup");
          const popupMsg = document.getElementById("popupMessage");

          popupMsg.textContent = `Congratulations ${data.full_name}! üéâ You‚Äôve successfully enrolled in the ${data.course_name} course.`;
          popup.classList.remove("hidden");
          popup.classList.add("flex");

          payBtn.textContent = "Successfully Enrolled";
          payBtn.classList.add("bg-green-600");

          // Auto redirect after 5 seconds
          setTimeout(() => {
            popup.classList.add("hidden");
            window.history.back(); // or window.location.href = "SSC.html";
          }, 5000);

        },
        prefill: {
          name: data.full_name,
          email: user.email,
          contact: data.phone
        },
        theme: {
          color: "#2563eb" // Tailwind blue-600
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();

      rzp.on("payment.failed", function (response) {
        alert("‚ùå Payment Failed: " + response.error.description);
        payBtn.textContent = "Pay Now ‚Çπ2";
        payBtn.disabled = false;
      });
    });
  </script>
</body>

</html>