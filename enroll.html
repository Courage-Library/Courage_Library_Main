<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enroll Now | Courage Library</title>
  <link rel="icon" type="image/png" href="/images/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body class="bg-gray-50 text-gray-900 flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="bg-white/90 backdrop-blur-lg shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a class="flex items-center space-x-2" href="index.html">
        <img src="/images/logo.png" alt="Logo" class="w-8 h-8">
        <span class="text-3xl font-bold text-blue-700 cursor-pointer">Courage Library</span>
      </a>
      <div class="space-x-6 hidden md:flex items-center">
        <a href="index.html#features" class="hover:text-blue-600">Features</a>
        <a href="index.html#courses" class="hover:text-blue-600">Courses</a>
        <a href="index.html#testimonials" class="hover:text-blue-600">Testimonials</a>
        <a href="Blog/Blog.html" class="hover:text-blue-600">Blog</a>
        <a href="index.html#contact" class="hover:text-blue-600">Contact</a>
        <a href="index.html"
          class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 rounded-full shadow hover:scale-110 transition">
          Home
        </a>
      </div>
      <div class="md:hidden" x-data="{ open: false }">
        <button @click="open = !open" class="focus:outline-none">
          <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div x-show="open" @click.away="open = false"
          class="absolute right-4 mt-4 w-40 bg-white rounded-lg shadow-md py-2 px-2 z-50 space-y-3">
          <a href="index.html#courses" class="hover:text-blue-600 flex items-center gap-2 relative pl-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-0 w-5 h-5 text-blue-500" fill="currentColor"
              viewBox="0 0 24 24">
              <path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z" />
            </svg>
            Courses
          </a>
          <!-- Features -->
          <a href="index.html#features" class="hover:text-blue-600 flex items-center gap-2 relative pl-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-0 w-5 h-5 text-blue-500" fill="currentColor"
              viewBox="0 0 24 24">
              <path d="M12 2L8.56 8.22 1 9.27l5.5 5.47-1.3 7.72L12 18.78l7.8 4.68-1.3-7.72L23 9.27l-7.56-1.05z" />
            </svg>
            Features
          </a>

          <!-- Reviews -->
          <a href="index.html#testimonials" class="hover:text-blue-600 flex items-center gap-2 relative pl-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-0 w-5 h-5 text-blue-500" fill="currentColor"
              viewBox="0 0 24 24">
              <path
                d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z" />
            </svg>
            Reviews
          </a>

          <!-- Blog -->
          <a href="/Blog/Blog.html" class="hover:text-blue-600 flex items-center gap-2 relative pl-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-0 w-5 h-5 text-blue-500" fill="currentColor"
              viewBox="0 0 24 24">
              <path
                d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm1 7V3.5L20.5 9H15zM8 12h8v2H8v-2zm0 4h5v2H8v-2z" />
            </svg>
            Blog
          </a>

          <!-- Contact Us -->
          <a href="index.html#contact" class="hover:text-blue-600 flex items-center gap-2 relative pl-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-0 w-5 h-5 text-blue-500" fill="currentColor"
              viewBox="0 0 24 24">
              <path
                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
            </svg>
            Contact Us
          </a>
          <a href="index.html"
            class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-5 py-2 rounded-full shadow hover:scale-110 transform transition ripple hidden">
            Home
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Section -->
  <main class="flex-grow flex justify-center items-start px-4 py-8 md:py-12">
    <div
      class="bg-white/90 backdrop-blur-xl border border-gray-200 p-8 md:p-10 rounded-2xl shadow-2xl w-full max-w-md text-center">
      <h1 class="text-2xl sm:text-3xl font-bold text-blue-700 mb-4">Enroll Now</h1>
      <p class="text-gray-600 mb-6 text-sm">Choose your course and complete the details below to begin your journey
        with Courage Library.</p>

      <form id="enrollForm" class="space-y-4 text-left" x-data>

        <!-- Course Dropdown -->
        <div x-data="courseDropdown()" class="relative">
          <label class="block text-sm font-medium text-gray-600 mb-1">Select Course<span class="text-blue-600">
              *</span></label>
          <button type="button" @click="open = !open"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
            <span x-text="selected || 'Choose a Course'" class="text-gray-700"></span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': open }">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div x-show="open" @click.outside="open=false"
            class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
            <div @click="selected='Free Trial'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer font-medium text-blue-600">Free Trial</div>
            <div @click="selected='SSC CGL'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC CGL</div>
            <div @click="selected='SSC MTS'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC MTS</div>
            <div @click="selected='SSC GD'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">SSC GD</div>
            <div @click="selected='Delhi Police'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Delhi
              Police</div>
          </div>
          <input type="hidden" name="course_name" :value="selected">
        </div>

        <!-- Full Name -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Full Name<span class="text-blue-600">
              *</span></label>
          <input type="text" name="full_name" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Gender Dropdown -->
        <div x-data="{ open: false, selected: '' }" class="relative">
          <label class="block text-sm font-medium text-gray-600 mb-1">Gender<span class="text-blue-600">
              *</span></label>
          <button type="button" @click="open = !open"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
            <span x-text="selected || 'Select Gender'" class="text-gray-700"></span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': open }">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div x-show="open" @click.outside="open=false"
            class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
            <div @click="selected='Male'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Male</div>
            <div @click="selected='Female'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Female</div>
            <div @click="selected='Other'; open=false" class="px-4 py-2 hover:bg-blue-50 cursor-pointer">Other</div>
          </div>
          <input type="hidden" name="gender" :value="selected">
        </div>

        <!-- DOB Dropdown (Day, Month, Year) -->
        <div x-data="{ day:'', month:'', year:'', openDay:false, openMonth:false, openYear:false }">
          <label class="block text-sm font-medium text-gray-600 mb-2">Date of Birth<span class="text-blue-600">
              *</span></label>
          <div class="grid grid-cols-3 gap-2">
            <!-- Day -->
            <div class="relative">
              <button type="button" @click="openDay=!openDay"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="day || 'Day'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openDay }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openDay" @click.outside="openDay=false"
                class="absolute mt-2 w-full max-h-40 overflow-y-auto bg-white border rounded-lg shadow-lg z-10">
                <template x-for="d in 31" :key="d">
                  <div @click="day=d;openDay=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="d"></div>
                </template>
              </div>
            </div>

            <!-- Month -->
            <div class="relative">
              <button type="button" @click="openMonth=!openMonth"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="month || 'Month'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openMonth }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openMonth" @click.outside="openMonth=false"
                class="absolute mt-2 w-full bg-white border rounded-lg shadow-lg z-10">
                <template x-for="m in ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']"
                  :key="m">
                  <div @click="month=m;openMonth=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="m">
                  </div>
                </template>
              </div>
            </div>

            <!-- Year -->
            <div class="relative">
              <button type="button" @click="openYear=!openYear"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center hover:shadow focus:ring-2 focus:ring-blue-400">
                <span x-text="year || 'Year'" class="text-gray-700"></span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                  stroke="currentColor" class="w-4 h-4 text-blue-600 transform" :class="{ 'rotate-180': openYear }">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div x-show="openYear" @click.outside="openYear=false"
                class="absolute mt-2 w-full max-h-40 overflow-y-auto bg-white border rounded-lg shadow-lg z-10">
                <template x-for="y in Array.from({length:70},(_,i)=>new Date().getFullYear()-i)" :key="y">
                  <div @click="year=y;openYear=false" class="px-3 py-1 hover:bg-blue-50 cursor-pointer" x-text="y">
                  </div>
                </template>
              </div>
            </div>
          </div>
          <input type="hidden" name="dob" :value="`${day}-${month}-${year}`">
        </div>

        <!-- Phone -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Phone Number<span class="text-blue-600">
              *</span></label>
          <input type="tel" inputmode="numeric" pattern="[0-9]{10}" name="phone" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Qualification -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Qualification<span class="text-blue-600">
              *</span></label>
          <input type="text" name="qualification" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Address -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">Address<span class="text-blue-600">
              *</span></label>
          <textarea name="address" required
            class="w-full border border-gray-300 p-2 rounded-md focus:ring-2 focus:ring-blue-400"></textarea>
        </div>

        <!-- Plan Selection -->
        <div x-data="planLogic()" class="space-y-3">

          <label class="block text-sm font-medium text-gray-600">
            Select Plan <span class="text-blue-600">*</span>
          </label>

          <!-- GRID -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

            <template x-for="plan in [

  { 
    code:'FREE',
    name:'Free Trial Plan',
    duration:'7 Days Access',
    price:0,
    days:7
  },

  { 
    code:'FOCUS',
    name:'Focused Preparation Plan',
    duration:'3 Months',
    price:1199,
    days:90,
    smart:true
  },

  { 
    code:'HUSTLE',
    name:'Consistent Growth Plan',
    duration:'6 Months',
    price:1999,
    days:180,
    popular:true
  },

  { 
    code:'SELECTION',
    name:'Final Selection Plan',
    duration:'12 Months',
    price:2999,
    days:365,
    best:true
  }

]" :key="plan.code">

              <!-- CARD -->
              <div @click="selectPlan(plan); handlePlanSelect(plan)" :class="selectedPlan?.code === plan.code
    ? 'relative border border-blue-600 ring-1 ring-blue-300 bg-blue-50 rounded-xl p-4 cursor-pointer transition hover:shadow-sm'
    : 'relative border border-gray-200 bg-white rounded-xl p-4 cursor-pointer transition hover:shadow-sm'">

                <!-- BADGE ROW (FIXED POSITION) -->
                <div class="absolute top-3 right-3 flex flex-col gap-1">

                  <!-- Smart Start (FOCUS) -->
                  <template x-if="plan.smart">
                    <span class="px-2 py-0.5 text-[10px] font-medium rounded-full
      bg-blue-50 text-blue-700 border border-blue-200">
                      Smart Start
                    </span>
                  </template>

                  <!-- Most Popular (HUSTLE) -->
                  <template x-if="plan.popular">
                    <span class="px-2 py-0.5 text-[10px] font-medium rounded-full
      bg-orange-50 text-orange-600 border border-orange-200">
                      Most Popular
                    </span>
                  </template>

                  <!-- Best Value (SELECTION) -->
                  <template x-if="plan.best">
                    <span class="px-2 py-0.5 text-[10px] font-medium rounded-full
      bg-indigo-50 text-indigo-700 border border-indigo-200">
                      Best Value
                    </span>
                  </template>

                </div>

                <!-- CONTENT -->
                <div class="flex flex-col gap-3">

                  <!-- PLAN TITLES -->
                  <div>
                    <h3 class="text-base font-semibold text-gray-800 leading-tight" x-text="plan.code"></h3>

                    <p class="text-xs text-gray-500 leading-snug" x-text="plan.name"></p>
                  </div>

                  <!-- PRICE ROW -->
                  <div class="flex items-end justify-between">
                    <p class="text-xs text-gray-600" x-text="plan.duration"></p>

                    <div class="text-right">
                      <p class="text-lg font-bold text-blue-700 leading-none">
                        ‚Çπ<span x-text="plan.price"></span>
                      </p>
                    </div>
                  </div>

                </div>
              </div>
            </template>

          </div>

          <!-- HIDDEN INPUTS -->
          <input type="hidden" name="plan_code" :value="selectedPlan?.code">
          <input type="hidden" name="plan_name" :value="selectedPlan?.name">
          <input type="hidden" name="plan_duration" :value="selectedPlan?.duration">
          <input type="hidden" name="plan_price" :value="selectedPlan?.price">
          <input type="hidden" name="plan_days" :value="selectedPlan?.days">

        </div>

        <!-- Coupon Code -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Have a Coupon?
          </label>

          <div class="flex w-full gap-2">

            <input id="couponInput" type="text" class="w-0 flex-1 min-w-0 border border-gray-300 p-2 rounded-md uppercase
    focus:ring-2 focus:ring-blue-400" />

            <button type="button" id="applyCouponBtn"
              class="shrink-0 px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
              Apply
            </button>

          </div>
        </div>

        <!-- Price Preview -->
        <div id="pricePreview" class="hidden bg-blue-50 border rounded-lg p-3 text-sm">
          <div class="flex justify-between">
            <span>Original Price</span>
            <span id="originalPrice">‚Çπ0</span>
          </div>

          <div class="flex justify-between text-green-600">
            <span>Discount</span>
            <span>- ‚Çπ<span id="discountAmount">0</span></span>
          </div>

          <hr class="my-2">

          <div class="flex justify-between font-semibold text-blue-700">
            <span id="payableLabel">Payable Amount</span>
            <span>‚Çπ<span id="finalAmount">0</span></span>
          </div>
        </div>

        <div class="mt-4 border-t pt-4">
          <div class="flex items-center justify-center gap-2 bg-gray-50 rounded-lg py-2 px-3 text-xs text-gray-600">

            <!-- Filled Lock Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" viewBox="0 0 24 24"
              fill="currentColor">
              <path
                d="M17 8V6a5 5 0 10-10 0v2H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1zm-8 0V6a3 3 0 016 0v2H9z" />
            </svg>

            <span>
              Secure payment ‚Ä¢ Powered by
              <span class="font-semibold text-gray-700">Razorpay</span>
            </span>

          </div>
        </div>

        <!-- Pay Button -->
        <button id="payBtn" type="button" disabled
          class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-md font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center">

          <span id="payText">Select Plan to Continue</span>

          <span id="paySpinner"
            class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin">
          </span>

        </button>

        <p id="successMsg" class="hidden text-green-600 text-center font-semibold mt-3">Successfully Enrolled!</p>
      </form>
    </div>

    <!-- Success Popup Modal -->
    <div id="successPopup" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
      <div class="bg-white rounded-2xl p-8 text-center shadow-2xl max-w-sm w-full transform transition-all scale-100">
        <div class="flex justify-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-blue-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 12l2 2l4-4m5 2a9 9 0 11-18 0a9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-blue-600 mb-2">Congratulations!</h2>
        <p id="popupMessage" class="text-gray-700 mb-4">
          You have successfully enrolled!
        </p>
        <p class="text-sm text-gray-500">Redirecting you in 5 seconds...</p>
      </div>
    </div>
    <style>
      #successPopup[x-show="visible"] {
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }

        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .animate-fadeIn {
        animation: fadeIn 0.4s ease-out;
      }

      @keyframes slideUp {
        from {
          transform: translateY(40px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .animate-slideUp {
        animation: slideUp 0.25s ease-out;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(120%);
          opacity: 0;
        }

        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }

        to {
          transform: translateX(120%);
          opacity: 0;
        }
      }

      .toast-in {
        animation: slideInRight 0.35s ease-out forwards;
      }

      .toast-out {
        animation: slideOutRight 0.3s ease-in forwards;
      }
    </style>

    <!-- Bottom Sheet Upgrade Popup -->
    <div id="upgradePopup" class="fixed inset-0 bg-black/50 hidden z-50 items-end sm:items-center justify-center">

      <!-- Sheet -->
      <div
        class="bg-white w-full sm:max-w-sm rounded-t-3xl sm:rounded-2xl shadow-2xl p-5 sm:p-6 animate-slideUp relative">

        <!-- Drag Indicator (Mobile Look) -->
        <div class="w-10 h-1.5 bg-gray-300 rounded-full mx-auto mb-4 sm:hidden"></div>

        <!-- Close -->
        <button onclick="closeUpgradePopup()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl">
          √ó
        </button>

        <!-- Icon -->
        <div class="flex justify-center mb-4">
          <div
            class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-blue-600" fill="currentColor"
              viewBox="0 0 24 24">
              <path d="M5 16l-2-8 5 3 4-6 4 6 5-3-2 8H5zm0 2h14v2H5v-2z" />
            </svg>
          </div>
        </div>

        <!-- Title -->
        <h2 class="text-base sm:text-lg font-semibold text-center text-gray-800 mb-2">
          Free Trial Already Used
        </h2>

        <!-- Description -->
        <p class="text-gray-600 text-sm text-center mb-5">
          Upgrade to a premium plan to continue your preparation.
        </p>

        <!-- Single Button -->
        <button onclick="closeUpgradePopup(); showToast('Select a premium plan below.', 'info');"
          class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-xl font-semibold shadow hover:opacity-95 transition">
          Select Premium Plans
        </button>

      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-blue-700 to-indigo-700 text-gray-100 py-5 mt-auto">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
      <p class="mb-4 md:mb-0">&copy; 2025 Courage Library. All rights reserved.</p>
      <div class="flex space-x-6">
        <a href="https://www.facebook.com/people/Courage-Library/61561969000820/?mibextid=ZbWKwL" target="_blank"
          class="hover:text-white text-2xl"><i class="fab fa-facebook-f"></i></a>
        <a href="https://x.com/CourageLibrary" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-twitter"></i></a>
        <a href="https://www.linkedin.com/company/courage-library" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-linkedin-in"></i></a>
        <a href="https://www.instagram.com/couragelibrary1" target="_blank" class="hover:text-white text-2xl"><i
            class="fab fa-instagram"></i></a>
      </div>
    </div>
  </footer>

  <!-- Supabase -->
  <script>
    const SUPABASE_URL = "https://sgagswxzsxlgcspwiuoh.supabase.co";
    const SUPABASE_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnYWdzd3h6c3hsZ2NzcHdpdW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NTA1NTIsImV4cCI6MjA2OTUyNjU1Mn0.ZNfk5WNDPkjKcFsRO48rEYk3dhbLYm_m21aZ-wfywo4";

    const supabaseClient = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_KEY
    );

    const payBtn = document.getElementById("payBtn");
    const form = document.getElementById("enrollForm");

    async function getCurrentUser() {
      const { data } = await supabaseClient.auth.getSession();
      const session = data.session;

      if (!session) {
        showToast("Please login first.", "error");
        setTimeout(() => {
          window.location.href = "index.html?checkAuth=1";
        }, 1200);   // 1.2 seconds
        return null;
      }

      return session;   // üî• return full session, not just user
    }

    function resetPayButton() {
      document.getElementById("payText").textContent = "Pay Now";
      document.getElementById("paySpinner").classList.add("hidden");
      payBtn.disabled = false;
      payBtn.dataset.locked = "";
    }

    payBtn.addEventListener("click", async () => {
      if (payBtn.dataset.locked) return;
      payBtn.dataset.locked = "true";

      const popup = document.getElementById("successPopup");
      const popupMsg = document.getElementById("popupMessage");

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      function stopWithToast(message) {
        payBtn.dataset.locked = "";
        showToast(message, "error");
        return true;
      }

      if (!data.plan_code)
        return stopWithToast("Please select a plan first.");

      if (!data.course_name)
        return stopWithToast("Please select a course.");

      if (!data.gender)
        return stopWithToast("Please select gender.");

      if (!data.dob || !data.dob.includes("-"))
        return stopWithToast("Please select complete Date of Birth.");

      const [day, month, year] = data.dob.split("-");

      if (!day || !month || !year)
        return stopWithToast("Please select complete Date of Birth.");

      document.getElementById("payText").textContent = "Processing";
      document.getElementById("paySpinner").classList.remove("hidden");
      payBtn.disabled = true;

      const session = await getCurrentUser();
      if (!session) {
        resetPayButton();
        return;
      }

      const user = session.user;

      try {
        /* üîê CALL SUPABASE EDGE FUNCTION */
        const orderRes = await fetch(
          `${SUPABASE_URL}/functions/v1/create-razorpay-order`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${session.access_token}`
            },
            body: JSON.stringify({
              plan_code: data.plan_code,
              coupon_code: appliedCoupon,
              preview: false,
              user_email: user.email
            })
          }
        );

        const order = await orderRes.json();

        if (!orderRes.ok) {

          if (order.error === "Free trial already used.") {
            showUpgradePopup();
          } else {
            showToast(order.error || "Unable to start payment", "error");
          }

          resetPayButton();
          return;
        }

        // üöÄ HANDLE 100% FREE COUPON (Skip Razorpay)
        if (!order.final_amount || order.final_amount <= 0) {

          data.user_email = user.email;
          data.payment_status = "free";
          data.payment_id = "FREE_COUPON";
          data.valid_till = new Date(
            new Date().setDate(new Date().getDate() + order.plan_days)
          ).toISOString().split("T")[0];

          const { error } = await supabaseClient
            .from("student_enrollments")
            .insert([data]);

          if (error) {
            showToast("Enrollment failed: " + error.message, "error");
            resetPayButton();
            return;
          }

          popupMsg.innerHTML = `
            <div class="space-y-1">
              <p>Congratulations <strong>${data.full_name}</strong>!</p>
              <p>You are enrolled in <strong>${data.plan_name}</strong>.</p>
              <p>Valid till <strong>${data.valid_till}</strong>.</p>
            </div>
            `;

          popup.classList.remove("hidden");
          popup.classList.add("flex", "animate-fadeIn");

          resetPayButton();

          setTimeout(() => {
            window.location.replace("dashboard.html");
          }, 3000);

          return; // üî• STOP ‚Äî DO NOT OPEN RAZORPAY
        }

        data.final_amount = order.final_amount;

        /* üìÖ VALID TILL (FROM SERVER DAYS) */
        const today = new Date();
        const validTill = new Date(today);
        validTill.setDate(validTill.getDate() + order.plan_days);

        data.user_email = user.email;
        data.payment_status = "paid";
        data.valid_till = validTill.toISOString().split("T")[0];
        data.final_amount = order.final_amount;

        /* üí≥ RAZORPAY OPTIONS (SECURE ORDER) */
        const options = {
          key: "rzp_live_RdymXUT2ibglux",
          order_id: order.order_id,
          amount: order.final_amount * 100,
          currency: "INR",
          name: "Courage Library",
          description: `${data.plan_name} - ${data.course_name}`,
          image: "/images/logo.png",

          handler: async function (response) {
            try {
              data.payment_id = response.razorpay_payment_id;

              const { error } = await supabaseClient
                .from("student_enrollments")
                .insert([data]);

              if (error) {
                showToast("Enrollment failed: " + error.message, "error");
                resetPayButton();
                return;
              }

              /* üìß SEND EMAIL (NON-BLOCKING) */
              fetch(
                `${SUPABASE_URL}/functions/v1/send-enrollment-email`,
                {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    email: data.user_email,
                    name: data.full_name,
                    course: data.course_name,
                    validTill: data.valid_till
                  })
                }
              ).catch(() => { });

              popupMsg.innerHTML = `
                <div class="space-y-1">
                  <p>Congratulations <strong>${data.full_name}</strong>!</p>
                  <p>You are enrolled in <strong>${data.plan_name}</strong>.</p>
                  <p>Valid till <strong>${data.valid_till}</strong>.</p>
                </div>
                `;

              popup.classList.remove("hidden");
              popup.classList.add("flex", "animate-fadeIn");

              resetPayButton();

              setTimeout(() => {
                window.location.replace("dashboard.html");
              }, 3000);

            } catch (err) {
              console.error(err);
              showToast("Something went wrong after payment.", "error");
              resetPayButton();
            }
          },

          modal: {
            ondismiss: function () {
              showToast("Payment was not completed.", "error");
              resetPayButton();
            }
          },

          prefill: {
            name: data.full_name,
            email: user.email,
            contact: data.phone
          },

          theme: { color: "#2563eb" }
        };

        const rzp = new Razorpay(options);
        rzp.open();

        rzp.on("payment.failed", function () {
          showToast("Payment failed.", "error");
          resetPayButton();
        });

      } catch (err) {
        console.error(err);
        showToast("Unable to start payment.", "error");
        resetPayButton();
      }
    });

    const applyCouponBtn = document.getElementById("applyCouponBtn");
    const couponInput = document.getElementById("couponInput");
    const couponMsg = document.getElementById("couponMsg");
    const pricePreview = document.getElementById("pricePreview");
    const originalPriceEl = document.getElementById("originalPrice");
    const discountAmountEl = document.getElementById("discountAmount");
    const finalAmountEl = document.getElementById("finalAmount");

    let appliedCoupon = null;

    couponInput.addEventListener("input", () => {
      couponMsg.textContent = "";
      document.getElementById("payableLabel").textContent = "Payable Amount";
    });

    applyCouponBtn.addEventListener("click", async () => {
      const code = couponInput.value.trim().toUpperCase();
      couponInput.value = code;

      if (!code) return showToast("Enter coupon code", "error");

      const planCode = document.querySelector('[name="plan_code"]').value;
      if (!planCode) return showToast("Select plan first", "error");

      applyCouponBtn.textContent = "Checking...";
      applyCouponBtn.disabled = true;

      try {
        const { data } = await supabaseClient.auth.getSession();
        const session = data.session;

        if (!session) {
          showToast("Please login first.", "error");
          return;
        }

        const res = await fetch(
          `${SUPABASE_URL}/functions/v1/create-razorpay-order`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${session.access_token}`
            },
            body: JSON.stringify({
              plan_code: planCode,
              coupon_code: code,
              preview: true
            })
          }
        );

        const result = await res.json();

        if (!res.ok || result.discount <= 0) {
          throw new Error("Invalid coupon");
        }

        // Show preview
        // Show preview
        originalPriceEl.textContent = `‚Çπ${result.original_amount}`;
        discountAmountEl.textContent = result.discount;

        let final = result.final_amount;
        finalAmountEl.textContent = final;

        // üíé If fully FREE
        const payableLabel = document.getElementById("payableLabel");

        if (final === 0) {
          payableLabel.textContent = "Payable Amount (FREE)";
        } else {
          payableLabel.textContent = "Payable Amount";
        }

        pricePreview.classList.remove("hidden");

        showToast("Coupon applied successfully!", "success");

        appliedCoupon = code;

      } catch (err) {
        showToast("Invalid or expired coupon.", "error");
        pricePreview.classList.add("hidden");
        appliedCoupon = null;
        couponInput.value = "";
        couponInput.focus();
      } finally {
        applyCouponBtn.textContent = "Apply";
        applyCouponBtn.disabled = false;
      }
    });

    function courseDropdown() {
      return {
        open: false,
        selected: '',

        init() {
          const params = new URLSearchParams(window.location.search);
          const courseFromURL = params.get("course");

          if (courseFromURL) {
            this.selected = courseFromURL;
          }
        }
      }
    }

    function handlePlanSelect(plan) {

      const params = new URLSearchParams(window.location.search);
      const urlCoupon = params.get("coupon");

      if (urlCoupon) {
        setTimeout(() => {
          couponInput.value = urlCoupon;
          applyCouponBtn.click();
        }, 300);
      }

      document.getElementById("payBtn")
        .scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function showUpgradePopup() {
      const popup = document.getElementById("upgradePopup");
      popup.classList.remove("hidden");
      popup.classList.add("flex");
    }

    function closeUpgradePopup() {
      const popup = document.getElementById("upgradePopup");
      popup.classList.add("hidden");
      popup.classList.remove("flex");

      document.getElementById("payBtn")
        .scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function showToast(message, type = "info") {
      const toast = document.getElementById("customToast");
      const box = document.getElementById("toastBox");
      const icon = document.getElementById("toastIcon");
      const msg = document.getElementById("toastMessage");

      msg.textContent = message;

      box.classList.remove("border-blue-500", "border-green-500", "border-red-500");

      if (type === "success") {
        box.classList.add("border-green-500");
        icon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg"
        class="w-5 h-5 text-green-600"
        fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          stroke-width="2"
          d="M5 13l4 4L19 7"/>
      </svg>`;
      }
      else if (type === "error") {
        box.classList.add("border-red-500");
        icon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg"
        class="w-5 h-5 text-red-600"
        fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"/>
      </svg>`;
      }
      else {
        box.classList.add("border-blue-500");
        icon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg"
        class="w-5 h-5 text-blue-600"
        fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          stroke-width="2"
          d="M13 16h-1v-4h-1m1-4h.01"/>
      </svg>`;
      }

      toast.classList.remove("hidden");
      box.classList.remove("toast-out");
      box.classList.add("toast-in");

      setTimeout(() => {
        box.classList.remove("toast-in");
        box.classList.add("toast-out");

        setTimeout(() => {
          toast.classList.add("hidden");
        }, 300);
      }, 3000);
    }

    function planLogic() {
  return {
    selectedPlan: null,

    getCourse() {
      return document.querySelector('[name="course_name"]').value;
    },

    setCourse(value) {
      document.querySelector('[name="course_name"]').value = value;

      // Also update visible dropdown text
      const dropdown = document.querySelector('[x-data="courseDropdown()"]');
      if (dropdown && dropdown.__x) {
        dropdown.__x.$data.selected = value;
      }
    },

    selectPlan(plan) {

      const currentCourse = this.getCourse();

      // üîµ If FREE plan selected
      if (plan.code === "FREE") {

        // If no course selected ‚Üí auto select Free Trial
        if (!currentCourse) {
          this.setCourse("Free Trial");
        }

        // If another course selected ‚Üí block
        if (currentCourse && currentCourse !== "Free Trial") {
          showToast("Free Trial plan is only available for Free Trial course.", "error");
          return;
        }
      }

      // üîµ If Paid plan selected but Free Trial course chosen ‚Üí block
      if (plan.code !== "FREE" && currentCourse === "Free Trial") {
        showToast("Please select a regular course for paid plans.", "error");
        return;
      }

      this.selectedPlan = plan;

      const btn = document.getElementById('payBtn');
      btn.disabled = false;

      if (plan.price === 0) {
        document.getElementById('payText').textContent = 'Start Free Trial';
      } else {
        document.getElementById('payText').textContent = 'Pay Now';
      }
    }
  }
}

  </script>

  <!-- Toast Notification -->
  <div id="customToast" class="fixed top-[80px] sm:top-[90px] right-5 hidden z-[9999] max-w-[95%] sm:max-w-sm">

    <div id="toastBox" class="flex items-center gap-3 bg-white shadow-xl rounded-lg px-4 py-3 border-l-4">

      <div id="toastIcon"></div>

      <p id="toastMessage" class="text-gray-800 text-sm font-medium"></p>

    </div>
  </div>

</body>

</html>